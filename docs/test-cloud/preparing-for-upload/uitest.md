---
title: Preparing Xamarin.UITests for Upload
description: How to upload Xamarin.UITests to App Center for Test
keywords: test cloud
author: glennwester
ms.author: glwest
ms.reviewer: crdun
ms.date: 06/07/2018
ms.topic: article
ms.assetid: 10be6410-6661-45df-931d-2737ed369752
ms.service: vs-appcenter
ms.custom: test
---

# Preparing Xamarin.UITests for Upload

After UITests have been written for a Xamarin app, the app and tests may be uploaded to App Center for extensive testing on real devices. This section provides details on preparing a Xamarin mobile application before submitting Xamarin.UITests for Xamarin mobile apps to App Center for Test.

Before submitting a test, it is necessary to [create an app](~/dashboard/creating-and-managing-apps.md) in [Visual Studio App Center](https://appcenter.ms/), and then to create a _test run_ using the Test Run wizard that is available under the **Test** service.

When the Test Run Wizard is finished, it will provide a sample command line that can be used to submit the app and UITests to App Center for Test. These two snippets are examples of a command line generated by the Test Run wizard:

For a Xamarin.Android application, the Test Run wizard will create a command line similar to this snippet:

```
appcenter test run uitest --app "<APP NAME>" --devices "<DEVICE SET NAME>" --app-path <PATH_TO_APK> --test-series "<TEST SERIES>" --locale "en_US" --build-dir <PATH TO UITEST BUILD DIRECTORY>
```

For Xamarin.iOS, the Test Run wizard will create a command line that resembles the following snippet:

```
appcenter test run uitest --app "<APP NAME>" --devices <DEVICE SET ID> --app-path <PATH TO IPA> --test-series "<TEST SERIES>" --locale "en_US" --build-dir <PATH TO UITEST BUILD DIRECTORY>
```

The command line parameters include the following pieces of information that is specific to the rest run that was created:

* **APP NAME** &ndash; The name of the app that was created in App Center.
* **PATH TO APK / IPA** &ndash; This is the path to the app to be tested.
* **DEVICE SET NAME / ID** &ndash; This is a value that represents the _device set_ to run the apps on. A device set is a collection of devices and operating systems.
* **TEST SERIES** &ndash; This is a label that is used to group a series of related test runs together. By default, the value of the test series is _master_.
* **PATH TO UITEST BUILD DIRECTORY** &ndash; The path to the directory that holds the UITest assembly.

After the test run has been created, ensure that the following software is installed on the computer that will submit the tests:

1. Ensure that the computer has [Node.js](https://nodejs.org/en/) 6.3 installed.
2. Install the [App Center CLI](~/cli/index.md). Instructions for [installing the App Center CLI](https://github.com/Microsoft/AppCenter-CLI#installation) maybe be found in the [README.md on GitHub](https://github.com/Microsoft/AppCenter-CLI).

## Preparing Xamarin.Android Apps
> [!IMPORTANT]
> Running Xamarin.UITest on Windows requires [setting the ANDROID_HOME environment variable with the path to the Android SDK](https://www.360logica.com/blog/how-to-set-path-environmental-variable-for-sdk-in-windows/)

The two steps detail what is necessary to prepare a Xamarin.Android app and UITest for submission to App Center for Test:

1. Ensure that the app requests the `INTERNET` permission.
2. Disable the **Shared Mono Runtime**. The Shared Mono Runtime will prevent UITests from running in App Center for Test.

    On Visual Studio 2017, open the project properties, and select the **Android Options** tab. The first section, **Packaging Properties** will have a checkbox for the **Shared Mono Runtime**.

    On Visual Studio for Mac, look in the **Project Options**, under **Build > Android Build**. The **Packaging and Deployment** section of the  **General** tab will have a checkbox for the **Shared Mono Runtime**.

## Preparing Xamarin.iOS Apps
Xamarin.iOS apps must have the Xamarin Test Cloud Agent linked into the IPA. The Xamarin Test Cloud Agent is an special embedded HTTP server that allows UITests to interact with the iOS user interface. The Test Cloud Agent is added to the iOS project via NuGet. 

> [!TIP]
> Non-Xamarin.iOS apps are also supported by Xamarin.UITest, but instead of the Xamarin Test Cloud Agent require [linking Calabash]( https://github.com/calabash/calabash-ios/wiki/Tutorial%3A-How-to-add-Calabash-to-Xcode).

### Visual Studio (Mac)
For an iOS project In Visual Studio for Mac, right click on the **Packages** folder, select **Add Package**. Search for **Xamarin Test Cloud Agent**, and click **Add Package**:

![Adding the Xamarin Test Cloud Agent](~/test-cloud/preparing-for-upload/images/05-addpackage-xs.png)

### Visual Studio (Windows)
> [!IMPORTANT]
> Xamarin.UITests for iOS apps cannot be executed locally on Windows. You can still be create, compile and uploade to App Center Test from Windows.

For an iOS project In Visual Studio for Windows, right click on project and select **Manage NuGet Packages** from the context menu. In the **NuGet Package Manager** Search for **Xamarin Test Cloud Agent** and click **OK** to install that package:

![Adding the Xamarin Test Cloud Agent](~/test-cloud/preparing-for-upload/images/05-addpackage-vs.png)

### Initialize the Xamarin Test Cloud Agent
After adding the Xamarin Test Cloud Agent to the iOS project, you must initialize the Xamarin Test Cloud Agent when the iOS project starts up. Edit the `AppDelegate` class and add the following snippet to the `FinishedLaunching` method:

```csharp
#if ENABLE_TEST_CLOUD
Xamarin.Calabash.Start();
#endif
```
> [!WARNING]
> Your app will be rejected by Apple if you submit an app that includes the Xamarin Test Cloud Agent. The Xamarin Test Cloud Agent is only supported for apps signed with Development Provisioning Profiles.

When you surround the initialization code in the **ENABLE_TEST_CLOUD** conditional compile statement, the Xamarin linker will leave the Xamarin Test Cloud Agent in builds that use the **ENABLE_TEST_CLOUD** flag; conventionally **Debug** builds but not **Release** builds. New Xamarin.iOS apps created in Visual Studio use this approach.
